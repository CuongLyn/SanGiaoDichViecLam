@using BTL.PagedResults
@model PagedResult<CongViec>

<div class="container py-5">
    <div class="card shadow-sm rounded-4">
        <div class="card-body">
            <h3 class="text-center text-primary mb-4 fw-bold">Qu·∫£n l√Ω C√¥ng Vi·ªác</h3>

            <!-- Thanh t√¨m ki·∫øm -->
            <div class="input-group mb-4">
                <input type="text" id="searchInput" class="form-control rounded-start-pill" placeholder="üîç T√¨m theo ti√™u ƒë·ªÅ c√¥ng vi·ªác...">
                <button class="btn btn-outline-primary rounded-end-pill px-4" id="searchBtn">T√¨m</button>
            </div>

            <div class="table-responsive">
                <table class="table table-hover align-middle text-center shadow-sm rounded-3 overflow-hidden">
                    <thead class="bg-primary text-white">
                        <tr>
                            <th>Ti√™u ƒë·ªÅ</th>
                            <th>Nh√† tuy·ªÉn d·ª•ng</th>
                            <th>ƒê·ªãa ƒëi·ªÉm</th>
                            <th>Lo·∫°i h√¨nh</th>
                            <th>Ng√†y ƒëƒÉng</th>
                            <th>T√πy ch·ªçn</th>
                        </tr>
                    </thead>
                    <tbody id="jobTableBody">
                        @foreach (var job in Model.Items)
                        {
                            <tr id="job-@job.Id">
                                <td class="job-title">@job.TieuDe</td>
                                <td>@job.NhaTuyenDung.TenCongTy</td>
                                <td>@job.DiaDiem</td>
                                <td>@job.LoaiHinh</td>
                                <td>@job.NgayDang.ToString("dd/MM/yyyy")</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-danger delete-btn" data-id="@job.Id">
                                        <i class="bi bi-trash3"></i> X√≥a
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Ph√¢n trang -->
            <div class="d-flex justify-content-between align-items-center mt-4">
                <div class="text-muted">Trang @Model.PageNumber / @Model.TotalPages</div>
                <ul class="pagination pagination-sm mb-0">
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                            <a class="page-link rounded-pill" href="@Url.Action("JobManagement", new { pageNumber = i })">@i</a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // X·ª≠ l√Ω x√≥a
        $('.delete-btn').click(function () {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c√¥ng vi·ªác n√†y kh√¥ng?")) {
                const id = $(this).data('id');
                const row = $('#job-' + id);

                $.ajax({
                    url: '/Admin/DeleteJob/' + id,
                    type: 'DELETE',
                    success: function (res) {
                        if (res.success) {
                            row.fadeOut(300, function () { $(this).remove(); });
                        } else {
                            alert("L·ªói: " + res.message);
                        }
                    },
                    error: function () {
                        alert("X√≥a kh√¥ng th√†nh c√¥ng. Vui l√≤ng th·ª≠ l·∫°i.");
                    }
                });
            }
        });

        // X·ª≠ l√Ω t√¨m ki·∫øm
        $('#searchBtn').click(function () {
            const keyword = $('#searchInput').val().toLowerCase();

            $('#jobTableBody tr').each(function () {
                const title = $(this).find('.job-title').text().toLowerCase();
                if (title.includes(keyword)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });

        // Enter ƒë·ªÉ t√¨m
        $('#searchInput').keypress(function (e) {
            if (e.which == 13) {
                $('#searchBtn').click();
            }
        });
    });
</script>
